import express from "express"
import dotenv from "dotenv"
import mongoose, { connect } from "mongoose"
import session from "express-session"
import admin from "./Routers/Admin.js"
import user from "./Routers/User.js"
import category from "./Routers/category.js"
import product from "./Routers/product.js"
import cart from "./Routers/cart.js"
import order from "./Routers/order.js"
import logout  from "./Routers/logout.js"
import MongoStore from "connect-mongo"
import cors from 'cors'
import path from 'path'
dotenv.config()
const app= express()
app.use(express.json())
app.use(express.urlencoded({extended:true}))
async function connectDB() {
    try{
        await mongoose.connect(process.env.MONGO_URI)
        console.log("Database connected successfully")
    }
    catch(err){
        console.log(err)
        console.log("Connection failed")
    }
}
connectDB()
app.use(session({
    secret: process.env.SESSION_SECRET,
    resave:false,
    saveUninitialized:false,
    store:MongoStore.create({
        // client:mongoose.connection.getClient(),
        mongoUrl:process.env.MONGO_URI,
    }),
    // cookie:{
    //         maxAge:1000*60*60
    //     },
        rolling: true
}))
app.use(cors({
    origin:["http://localhost:5174","http://localhost:5173","http://localhost:5175","http://16.171.71.249/"],
    methods: ["GET", "POST", "PUT", "DELETE"],
    credentials:true
}))
app.use("/uploads", express.static(path.join(process.cwd(), "uploads")));
app.use('/api/admin',admin)
app.use('/api/user',user)
app.use('/api/category',category)
app.use('/api/product',product)
app.use('/api/cart',cart)
app.use('/api/order',order)
app.use('/api/logout',logout)
app.listen(process.env.PORT,()=>{console.log(`http://localhost:${process.env.PORT}`);
})
